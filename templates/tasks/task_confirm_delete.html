{% extends 'base.html' %}

{% block title %}Confirmar Exclusão - TaskFlow{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-5">
    <div class="row justify-content-center align-items-center min-vh-100">
        <div class="col-12 col-md-6 col-lg-4">
            <!-- Animated Card -->
            <div class="card-modern border-0 shadow-lg" style="animation: modalSlideIn 0.5s ease-out;">
                <!-- Header with Gradient -->
                <div class="card-header bg-gradient text-white text-center py-4 border-0" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                    <div class="mb-3">
                        <div class="d-inline-flex align-items-center justify-content-center bg-white bg-opacity-20 rounded-circle p-3" style="width: 80px; height: 80px;">
                            <i class="fas fa-exclamation-triangle text-white" style="font-size: 2rem; animation: pulse 2s infinite;"></i>
                        </div>
                    </div>
                    <h4 class="fw-bold mb-1">
                        <i class="fas fa-trash-alt me-2"></i>Confirmar Exclusão
                    </h4>
                    <p class="mb-0 opacity-75">Esta ação não pode ser desfeita</p>
                </div>
                
                <!-- Body -->
                <div class="card-body p-5 text-center">
                    <div class="mb-4">
                        <h5 class="fw-bold text-dark mb-3">
                            Tem certeza que deseja excluir esta tarefa?
                        </h5>
                        
                        <!-- Task Preview -->
                        <div class="glass-card p-4 mb-4">
                            <div class="d-flex align-items-start">
                                <div class="bg-primary rounded-circle p-2 me-3 flex-shrink-0">
                                    <i class="fas fa-sticky-note text-white"></i>
                                </div>
                                <div class="text-start">
                                    <h6 class="fw-bold text-dark mb-1">{{ object.title }}</h6>
                                    {% if object.description %}
                                        <p class="text-muted small mb-2">{{ object.description|truncatewords:10 }}</p>
                                    {% endif %}
                                    {% if object.due_date %}
                                        <div class="d-flex align-items-center text-muted small">
                                            <i class="fas fa-calendar-alt me-1"></i>
                                            <span>Vencimento: {{ object.due_date|date:"d/m/Y" }}</span>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Warning Message -->
                        <div class="alert alert-warning border-0 py-3" role="alert">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Atenção!</strong> Todos os dados relacionados a esta tarefa serão perdidos permanentemente.
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <form method="post" id="deleteForm">
                        {% csrf_token %}
                        <div class="d-flex flex-column flex-sm-row gap-3 justify-content-center">
                            <a href="{% url 'task_list' %}" class="btn btn-outline-modern btn-modern">
                                <i class="fas fa-arrow-left me-2"></i>Cancelar
                            </a>
                            <button type="button" class="btn btn-danger-modern btn-modern" onclick="confirmDelete()">
                                <i class="fas fa-trash me-2"></i>Sim, Excluir
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Additional Info -->
            <div class="text-center mt-4">
                <p class="text-white-50 small mb-0">
                    <i class="fas fa-shield-alt me-1"></i>
                    Seus dados estão protegidos. Esta ação só afetará a tarefa selecionada.
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="finalConfirmationModal" tabindex="-1" aria-labelledby="finalConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-card border-0">
            <div class="modal-header border-0 text-center">
                <div class="w-100">
                    <div class="mb-3">
                        <i class="fas fa-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="modal-title text-white" id="finalConfirmationModalLabel">
                        Última Confirmação
                    </h5>
                </div>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <p class="text-white mb-3">
                    Você está prestes a excluir permanentemente a tarefa:
                </p>
                <div class="bg-dark bg-opacity-25 rounded p-3 mb-3">
                    <strong class="text-white">"{{ object.title }}"</strong>
                </div>
                <p class="text-white-50 small mb-0">
                    Digite "EXCLUIR" para confirmar:
                </p>
                <input type="text" class="form-control-modern mt-3" id="confirmationInput" 
                       placeholder="Digite EXCLUIR" autocomplete="off">
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="btn btn-outline-modern" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancelar
                </button>
                <button type="button" class="btn btn-danger-modern" id="finalDeleteBtn" disabled onclick="executeDelete()">
                    <i class="fas fa-trash me-2"></i>Excluir Definitivamente
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Success Animation -->
<div class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" 
     id="successAnimation" style="display: none !important; z-index: 9999; background: rgba(0,0,0,0.8);">
    <div class="text-center">
        <div class="mb-4">
            <i class="fas fa-check-circle text-success" style="font-size: 4rem; animation: checkmark 1s ease-in-out;"></i>
        </div>
        <h4 class="text-white fw-bold">Tarefa Excluída!</h4>
        <p class="text-white-50">Redirecionando...</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Confirmation functionality
    function confirmDelete() {
        const modal = new bootstrap.Modal(document.getElementById('finalConfirmationModal'));
        modal.show();
        
        // Focus on input when modal opens
        document.getElementById('finalConfirmationModal').addEventListener('shown.bs.modal', function () {
            document.getElementById('confirmationInput').focus();
        });
    }
    
    // Monitor confirmation input
    document.getElementById('confirmationInput').addEventListener('input', function() {
        const input = this.value.toUpperCase();
        const deleteBtn = document.getElementById('finalDeleteBtn');
        
        if (input === 'EXCLUIR') {
            deleteBtn.disabled = false;
            deleteBtn.classList.add('btn-pulse');
        } else {
            deleteBtn.disabled = true;
            deleteBtn.classList.remove('btn-pulse');
        }
    });
    
    // Execute deletion
    function executeDelete() {
        const deleteBtn = document.getElementById('finalDeleteBtn');
        
        // Show loading state
        deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Excluindo...';
        deleteBtn.disabled = true;
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('finalConfirmationModal'));
        modal.hide();
        
        // Show success animation
        setTimeout(() => {
            document.getElementById('successAnimation').style.display = 'flex';
            
            // Submit form after animation
            setTimeout(() => {
                document.getElementById('deleteForm').submit();
            }, 1500);
        }, 500);
    }
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to cancel
        if (e.key === 'Escape') {
            window.location.href = '{% url "task_list" %}';
        }
        
        // Enter to confirm if input is focused and valid
        if (e.key === 'Enter' && document.activeElement.id === 'confirmationInput') {
            if (document.getElementById('confirmationInput').value.toUpperCase() === 'EXCLUIR') {
                executeDelete();
            }
        }
    });
    
    // Auto-focus on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Add entrance animation
        const card = document.querySelector('.card-modern');
        card.style.opacity = '0';
        card.style.transform = 'translateY(50px) scale(0.9)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0) scale(1)';
        }, 100);
    });
    
    // Add custom animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes modalSlideIn {
            0% {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }
        
        @keyframes checkmark {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(180deg);
                opacity: 1;
            }
            100% {
                transform: scale(1) rotate(360deg);
                opacity: 1;
            }
        }
        
        .btn-pulse {
            animation: btnPulse 1s ease-in-out infinite;
        }
        
        @keyframes btnPulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4);
            }
            50% {
                box-shadow: 0 0 0 10px rgba(220, 38, 38, 0);
            }
        }
        
        .glass-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-modern {
            overflow: hidden;
            border-radius: 20px;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1));
            border: 1px solid rgba(245, 158, 11, 0.2);
            color: #92400e;
        }
        
        .bg-gradient {
            position: relative;
            overflow: hidden;
        }
        
        .bg-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shine 3s ease-in-out infinite;
        }
        
        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .min-vh-100 {
            min-height: 100vh;
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %} 